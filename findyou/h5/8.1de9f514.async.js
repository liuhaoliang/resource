(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[8],{UsdD:function(e,t,a){"use strict";a.r(t),a.d(t,"default",function(){return y});a("D2jH");var i=a("2ROE"),o=(a("HVTF"),a("OT5E")),n=(a("WQyz"),a("LoM5")),s=a("q1tI"),r=a.n(s),l=a("LvDl"),d=a.n(l),c=a("XGU7"),h=a.n(c),p=a("eOZ3"),m=(a("ioqJ"),a("uD3r")),u=a("dCQc"),w=a("+n12"),g=a("3rPQ"),f=n["a"].Item,v=window.AMap,b=window.AMapUI;class y extends s["Component"]{constructor(){super(...arguments),this.state={menuVisible:!1},this.initMap=(()=>{this.map=new v.Map("container",{zoom:11,resizeEnable:!0}),v.plugin(["AMap.ToolBar","AMap.Scale","AMap.OverView","AMap.Geolocation"],()=>{var e=new v.Scale,t=new v.ToolBar({position:"RT"}),a=new v.OverView;this.map.addControl(e),this.map.addControl(t),this.map.addControl(a),this.geolocation=new v.Geolocation({enableHighAccuracy:!0,timeout:1e4,buttonPosition:"RT",buttonOffset:new v.Pixel(13,20),zoomToAccuracy:!0}),this.map.addControl(this.geolocation),this.updateMyLocation()}),b.loadUI(["overlay/SimpleInfoWindow"],e=>{this.infoWindow=new e({infoTitle:"<strong>\u4f4d\u7f6e\u4fe1\u606f</strong>",infoBody:"",offset:new v.Pixel(0,-50)})})}),this.updateMyLocation=(()=>{this.geolocation&&this.geolocation.getCurrentPosition((e,t)=>{"complete"===e||o["a"].show(t.message)})}),this.onMenuSelect=(e=>{this.setState({menuVisible:!1});var t=e.key;if("refresh"===t){var a=Object(w["b"])("group_id");Object(u["k"])({group_id:a}).then(e=>{var t=e||{},a=(t.data,t.status),i=t.msg,n=void 0===i?"\u64cd\u4f5c\u5931\u8d25":i;a?(o["a"].success("\u5237\u65b0\u4f4d\u7f6e\u6210\u529f"),this.debounceLoadData(),this.updateMyLocation()):o["a"].show(n)})}}),this.loadData=(()=>{var e=Object(w["b"])("group_id");Object(u["h"])({group_id:e}).then(e=>{var t=e||{},a=t.data,i=t.status,n=t.msg,s=void 0===n?"\u67e5\u8be2\u5931\u8d25":n;i?this.addMarkers(a):o["a"].show(s)})}),this.addMarkers=(e=>{var t=e.filter(e=>e.uid!==g["a"].getUid()).map(e=>{var t=e.address,a=e.latitude,i=e.longitude,o=e.nickname,n=(e.uid,e.username),s=o||n;s=s.substr(0,m["a"].MAX_NICKNAME_LENGTH);var r=new v.Marker({position:new v.LngLat(i,a),label:{offset:new v.Pixel(-25,-25),content:'<div style="width:60px;text-align:center;">'.concat(s,"</div>")}});return r.on("click",e=>{this.infoWindow.setInfoTitle("<strong>".concat(o||n,"\u7684\u4f4d\u7f6e\u4fe1\u606f</strong>")),this.infoWindow.setInfoBody(t),this.infoWindow.open(this.map,r.getPosition())}),r.on("dblclick",e=>{r.markOnAMAP({name:t,position:r.getPosition()})}),r});this.infoWindow&&this.infoWindow.close(),this.markers?(this.markers.forEach(e=>{this.map.remove(e)}),this.markers.splice(0,this.markers.length)):this.markers=[],this.markers.push(...t),this.map.add(this.markers)}),this.debounceLoadData=d.a.debounce(()=>{this.loadData(),this.delayTimer=setTimeout(()=>{this.loadData()},3e3)},3e3)}componentDidMount(){this.initMap(),this.loadData()}componentWillUnmount(){this.debounceLoadData.cancel(),this.delayTimer&&clearInterval(this.delayTimer),this.map&&this.map.destroy()}render(){var e=this.state.menuVisible,t=r.a.createElement(n["a"],{visible:e,mask:!0,overlayStyle:{zIndex:1e4},overlay:[r.a.createElement(f,{key:"refresh",value:"refresh"},"\u5237\u65b0")],align:{overflow:{adjustY:0,adjustX:0},offset:[-10,0]},onSelect:this.onMenuSelect},r.a.createElement("div",{style:{height:"100%",padding:"0 15px",marginRight:"-15px",display:"flex",alignItems:"center"}},r.a.createElement(i["a"],{type:"ellipsis",onClick:t=>{this.setState({menuVisible:!e}),t.stopPropagation()}})));return r.a.createElement(p["a"],{title:"\u597d\u53cb\u5730\u56fe",pathname:this.props.location.pathname,rightContent:t},r.a.createElement("div",{className:h.a.wrapper},r.a.createElement("div",{className:h.a.map,id:"container"})))}}},XGU7:function(e,t,a){e.exports={wrapper:"wrapper___VvPXo",map:"map___29exZ"}}}]);